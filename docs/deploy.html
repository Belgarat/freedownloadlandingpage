<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deploy Guide - Book Landing Stack</title>
  <meta name="description" content="Production deployment guide for Book Landing Stack (Next.js 15, Supabase, Resend, Vercel Blob).">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸš€</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <nav class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex items-center">
          <a href="index.html" class="text-2xl font-bold text-teal-700">BLS</a>
          <div class="hidden md:ml-6 md:flex md:space-x-8">
            <a href="index.html#about" class="text-gray-900 hover:text-teal-700 px-3 py-2 text-sm font-medium">About</a>
            <a href="index.html#features" class="text-gray-900 hover:text-teal-700 px-3 py-2 text-sm font-medium">Features</a>
            <a href="index.html#roadmap" class="text-gray-900 hover:text-teal-700 px-3 py-2 text-sm font-medium">Roadmap</a>
            <a href="deploy.html" class="text-gray-900 hover:text-teal-700 px-3 py-2 text-sm font-medium">Deploy</a>
            <a href="index.html#whatsnew" class="text-gray-900 hover:text-teal-700 px-3 py-2 text-sm font-medium">What's New</a>
            <a href="index.html#community" class="text-gray-900 hover:text-teal-700 px-3 py-2 text-sm font-medium">Community</a>
          </div>
        </div>
        <div class="flex items-center">
          <a href="https://github.com/marcobrunet/booklandingstack" class="bg-teal-700 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-cyan-700 transition-colors">View on GitHub</a>
        </div>
      </div>
    </div>
  </nav>

  <header class="bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <h1 class="text-4xl font-bold text-gray-900">Production Deployment Guide</h1>
      <p class="text-gray-600 mt-2">Next.js 15 â€¢ Supabase â€¢ Resend â€¢ Vercel Blob â€¢ JSON Configs â€¢ Admin Auth</p>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <section class="mb-10">
      <h2 class="text-2xl font-semibold mb-3">Prerequisites</h2>
      <ul class="list-disc pl-6 text-gray-700 space-y-1">
        <li>Node.js 20 (enforced via <code>.nvmrc</code> and <code>engines.node</code>)</li>
        <li>GitHub account and repository</li>
        <li>Vercel account (recommended) or a server/VM/Docker environment</li>
      </ul>
    </section>

    <section class="mb-10">
      <h2 class="text-2xl font-semibold mb-3">Environment Variables</h2>
      <p class="text-gray-700 mb-2">Create <code>.env.local</code> and configure these values (also set them in your hosting provider):</p>
<pre class="bg-gray-900 text-gray-100 p-4 rounded-md overflow-x-auto text-sm"><code># Supabase
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Resend
RESEND_API_KEY=your_resend_api_key

# Site
NEXT_PUBLIC_SITE_URL=https://yourdomain.com

# Admin Auth (HttpOnly cookie)
ADMIN_PASSWORD=your_secure_admin_password
ADMIN_SECRET=your_hmac_secret_for_cookie_token

# Storage (Vercel Blob)
BLOB_READ_WRITE_TOKEN=vercel_blob_rw_token
</code></pre>
    </section>

    <section class="mb-10">
      <h2 class="text-2xl font-semibold mb-3">Database Setup (Supabase)</h2>
      <p class="text-gray-700 mb-3">Run the SQL in <code>migrations/anonymous_counters.sql</code> and <code>test-database.sql</code> as needed. Ensure tables <code>analytics</code> and <code>download_tokens</code> exist with indexes.</p>
      <details class="bg-white rounded-md border p-4"><summary class="cursor-pointer font-medium">Show schema snippet</summary>
<pre class="bg-gray-900 text-gray-100 p-4 rounded-md overflow-x-auto text-sm"><code>-- analytics & download_tokens tables are required
-- see README for full DDL and indexes
</code></pre>
      </details>
    </section>

    <section class="mb-10">
      <h2 class="text-2xl font-semibold mb-3">Option A â€” Vercel (Recommended)</h2>
      <ol class="list-decimal pl-6 text-gray-700 space-y-2">
        <li>Connect the GitHub repository to Vercel</li>
        <li>Set all environment variables for Production and Preview</li>
        <li>Ensure <code>next.config.js</code> allows <code>*.blob.vercel-storage.com</code> for images</li>
        <li>Trigger a deployment; Vercel detects Next.js automatically</li>
        <li>Add your custom domain and set it as the production URL</li>
      </ol>
      <div class="mt-3 p-4 bg-yellow-50 border border-yellow-200 rounded-md text-yellow-800">
        Note: Serverless file systems are ephemeral. Admin edits to JSON in production wonâ€™t persist across redeploys. Prefer Git-based config updates or use Option B with a persistent volume.
      </div>
    </section>

    <section class="mb-10">
      <h2 class="text-2xl font-semibold mb-3">Option B â€” Server/VM or Docker (Persistent)</h2>
      <ol class="list-decimal pl-6 text-gray-700 space-y-2">
        <li>Provision a Node 20 environment (Ubuntu/Debian or Docker)</li>
        <li>Clone the repository and create <code>.env</code> with the variables above</li>
        <li>Ensure the <code>config/</code> directory resides on a writable, persistent volume</li>
        <li>Install and build: <code>npm ci && npm run build</code></li>
        <li>Run: <code>npm start</code> behind a reverse proxy (Nginx/Caddy), enable HTTPS</li>
      </ol>
    </section>

    <section class="mb-10">
      <h2 class="text-2xl font-semibold mb-3">Email & Storage</h2>
      <ul class="list-disc pl-6 text-gray-700 space-y-1">
        <li>Resend: verify sending domain; set sender in <code>config/email.json</code></li>
        <li>Templates: customize <code>download</code> and <code>followup</code> with placeholders</li>
        <li>Vercel Blob: create a Read/Write token and set <code>BLOB_READ_WRITE_TOKEN</code></li>
      </ul>
    </section>

    <section class="mb-10">
      <h2 class="text-2xl font-semibold mb-3">Security</h2>
      <ul class="list-disc pl-6 text-gray-700 space-y-1">
        <li>Admin routes protected via middleware and HttpOnly cookie</li>
        <li>Use strong values for <code>ADMIN_PASSWORD</code> and <code>ADMIN_SECRET</code></li>
        <li>Cookies are <code>secure</code> in production</li>
      </ul>
    </section>

    <section class="mb-10">
      <h2 class="text-2xl font-semibold mb-3">Post-Deploy Checklist</h2>
      <ul class="list-disc pl-6 text-gray-700 space-y-1">
        <li>Visit <code>/admin</code> and log in</li>
        <li>Set Book, Content, Marketing, Theme, SEO, and Email configs</li>
        <li>Test cover upload; if it fails, verify <code>BLOB_READ_WRITE_TOKEN</code></li>
        <li>Trigger a test download to verify email delivery and token storage</li>
      </ul>
    </section>

    <section class="mb-16">
      <h2 class="text-2xl font-semibold mb-3">Further Reading</h2>
      <div class="flex flex-wrap gap-3">
        <a href="https://github.com/marcobrunet/booklandingstack#readme" class="inline-block bg-gray-900 text-white px-5 py-2 rounded-md">README</a>
        <a href="https://github.com/marcobrunet/booklandingstack/blob/develop/VERSION.md" class="inline-block border border-gray-900 text-gray-900 px-5 py-2 rounded-md hover:bg-gray-900 hover:text-white">VERSION</a>
      </div>
    </section>
  </main>

  <footer class="bg-gray-900 text-white py-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <p class="text-gray-400">Book Landing Stack â€” Deploy Guide</p>
    </div>
  </footer>
</body>
</html>


